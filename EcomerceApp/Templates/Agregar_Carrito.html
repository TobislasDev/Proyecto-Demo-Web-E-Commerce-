{% extends 'layouts/Base.html' %}
{% load static %}
{% block title %}Carrito de Compras{% endblock %}
{% block content %}
{% load humanize %}

<div class="container py-5">
    <div class="row">
        <div class="col-lg-12">
            <div class="card shadow-sm border-0 rounded-3">
                <div class="card-header bg-white border-0 py-3">
                    <h1 class="display-4 text-primary mb-3">Mi Lista de deseos</h1>
                    <hr class="text-muted">
                </div>
                <div class="card-body p-4">
                    {% if carrito_item %}
                        <div class="table-responsive">
                            <table class="table table-borderless align-middle">
                                <thead class="bg-light">
                                    <tr>
                                        <th scope="col" class="ps-4">Producto</th>
                                        <th scope="col" class="text-center">Cantidad</th>
                                        <th scope="col" class="text-center">Precio</th>
                                        <th scope="col" class="text-end pe-4">Subtotal</th>
                                        <th scope="col" class="text-center">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in carrito_item %}
                                    <tr class="border-bottom">
                                        <td class="ps-4">
                                            <div class="d-flex align-items-center">
                                                <img src="{{ item.producto.imagen.url }}" 
                                                     alt="{{ item.producto.name }}" 
                                                     class="rounded-3 me-3"
                                                     style="width: 60px; height: 60px; object-fit: cover;">
                                                <span class="fw-medium">{{ item.producto.name }}</span>
                                            </div>
                                        </td>
                                        <td class="text-center">
                                            <div class="d-flex align-items-center justify-content-center gap-2">
                                                <form action="{% url 'Eliminar_del_carrito' item.producto.id %}" method="POST" class="d-inline">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-sm btn-outline-secondary rounded-circle p-1" style="width: 32px; height: 32px;">
                                                        <i class="bi bi-dash"></i>
                                                    </button>
                                                </form>
                                                <span class="badge bg-light text-dark px-4 py-2 rounded-pill">
                                                    {{ item.cantidad }}
                                                </span>
                                                <form action="{% url 'Carrito_de_compras' item.producto.id %}" method="POST" class="d-inline">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-sm btn-outline-secondary rounded-circle p-1" style="width: 32px; height: 32px;">
                                                        <i class="bi bi-plus"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </td>
                                        <td class="text-center">${{ item.producto.precio|floatformat:0|intcomma }}</td>
                                        <td class="text-end pe-4">${{ item.total_producto|floatformat:0|intcomma }}</td>
                                        <td class="text-center">
                                            <form action="{% url 'Eliminar_carrito' item.producto.id %}" method="POST">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-sm btn-outline-danger rounded-circle p-1" style="width: 32px; height: 32px;">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="3" class="text-end pe-4">
                                            <span class="text-muted">Total</span>
                                        </td>
                                        <td class="text-end pe-4">
                                            <span class="fw-bold fs-5">${{ total|floatformat:0|intcomma }}</span>
                                        </td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <a href="{% url 'Productos' %}" 
                               class="btn btn-outline-secondary px-4">
                                <i class="bi bi-arrow-left me-2"></i>Seguir Comprando
                            </a>
                            <a href="#" 
                               class="btn btn-primary px-4">
                                Finalizar Compra<i class="bi bi-arrow-right ms-2"></i>
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <img src="{% static 'images/empty-cart.svg' %}" 
                                 alt="Carrito vacío" 
                                 class="mb-4" 
                                 style="width: 120px;">
                            <h3 class="h5 text-muted mb-3">Tu carrito está vacío</h3>
                            <a href="{% url 'Productos' %}" 
                               class="btn btn-primary px-4">
                                Explorar Productos
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .table th {
        font-weight: 500;
        text-transform: uppercase;
        font-size: 0.875rem;
        letter-spacing: 0.025em;
    }
    
    .badge {
        font-weight: 500;
    }
    
    .btn {
        padding-top: 0.625rem;
        padding-bottom: 0.625rem;
        font-weight: 500;
    }
    
    .btn-primary {
        background-color: #4F46E5;
        border-color: #4F46E5;
    }
    
    .btn-primary:hover {
        background-color: #4338CA;
        border-color: #4338CA;
    }
    
    .text-primary {
        color: #4F46E5 !important;
    }
    
    .card {
        background-color: #ffffff;
    }
    
    .bg-light {
        background-color: #F9FAFB !important;
    }

    .btn-outline-secondary:hover,
    .btn-outline-danger:hover {
        transform: scale(1.05);
        transition: transform 0.2s ease;
    }

    .rounded-circle.btn-sm {
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}